# ğŸ“‹ å®æ–½è®¡åˆ’ï¼šçƒ§çƒ¤åº—ç‚¹é¤è®°å½•ä¸æµæ°´ç³»ç»Ÿ

## ä»»åŠ¡ç±»å‹
- [x] å…¨æ ˆ (â†’ å¹¶è¡Œ)

## éœ€æ±‚æ‘˜è¦

ä¸ºçƒ§çƒ¤åº—è€æ¿ï¼ˆå•äººæ“ä½œï¼‰åˆ›å»ºç‚¹é¤è®°å½•å’Œè¥ä¸šæµæ°´ç®¡ç†ç³»ç»Ÿã€‚æœ¬åœ°éƒ¨ç½²ï¼ŒPC ä¸ºä¸»ã€ç§»åŠ¨ç«¯ä¸ºè¾…ï¼ˆå±€åŸŸç½‘è®¿é—®ï¼‰ã€‚

æ ¸å¿ƒç—›ç‚¹ï¼šè®°ä¸ä½ç‚¹é¤é¡ºåºã€ç»“è´¦è®¡ç®—æ…¢ã€æ— æ³•ç»Ÿè®¡è¥ä¸šé¢å’Œèœå“é”€å”®/åˆ©æ¶¦æ’è¡Œã€‚

## æŠ€æœ¯æ–¹æ¡ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|----------|------|
| å‰ç«¯æ¡†æ¶ | Vue 3 (Vite) + TypeScript | å›½å†…ç”Ÿæ€æˆç†Ÿï¼Œå¼€å‘æ•ˆç‡é«˜ |
| UI ç»„ä»¶åº“ | Naive UI | åŸç”Ÿ Vue 3 + TSï¼Œæ€§èƒ½ä¼˜ç§€ï¼ŒLayout ç³»ç»Ÿé€‚åˆåˆ†æ å¸ƒå±€ |
| CSS | Tailwind CSS | å¿«é€Ÿå“åº”å¼å¼€å‘ï¼Œé«˜åº¦è‡ªå®šä¹‰ |
| çŠ¶æ€ç®¡ç† | Pinia + pinia-plugin-persistedstate | æµè§ˆå™¨åˆ·æ–°ä¸ä¸¢å¤±å½“å‰æ“ä½œçŠ¶æ€ |
| å›¾è¡¨ | ECharts | ç»Ÿè®¡ä»ªè¡¨ç›˜å¯è§†åŒ– |
| åç«¯æ¡†æ¶ | Express + TypeScript | ç®€å•å¯é ï¼Œç¤¾åŒºèµ„æºä¸°å¯Œ |
| æ•°æ®åº“ | SQLite (better-sqlite3) | é›¶é…ç½®æœ¬åœ°éƒ¨ç½²ï¼ŒåŒæ­¥ API ç®€åŒ–äº‹åŠ¡å¤„ç† |
| å®æ—¶åŒæ­¥ | SSE (Server-Sent Events) | PC/æ‰‹æœºå¤šè®¾å¤‡åŒæ­¥ï¼Œæ¯” WebSocket ç®€å• |
| é‡‘é¢æ¨¡å‹ | æ•´æ•°åˆ† (cents) | é¿å…æµ®ç‚¹ç²¾åº¦é—®é¢˜ |

## é¡¹ç›®ç›®å½•ç»“æ„

```text
diancan/
â”œâ”€â”€ server/                          # åç«¯
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ app.ts                   # Express åº”ç”¨é…ç½®
â”‚       â”œâ”€â”€ server.ts                # å¯åŠ¨å…¥å£
â”‚       â”œâ”€â”€ config/
â”‚       â”‚   â””â”€â”€ constants.ts
â”‚       â”œâ”€â”€ shared/
â”‚       â”‚   â”œâ”€â”€ types.ts             # å…±äº«ç±»å‹å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ errors.ts            # é¢†åŸŸé”™è¯¯ç±»
â”‚       â”‚   â”œâ”€â”€ response.ts          # ç»Ÿä¸€å“åº”å°è£…
â”‚       â”‚   â””â”€â”€ validation.ts        # è¯·æ±‚æ ¡éªŒ
â”‚       â”œâ”€â”€ db/
â”‚       â”‚   â”œâ”€â”€ client.ts            # SQLite è¿æ¥ + PRAGMA
â”‚       â”‚   â”œâ”€â”€ migrate.ts           # è¿ç§»è¿è¡Œå™¨
â”‚       â”‚   â””â”€â”€ migrations/
â”‚       â”‚       â”œâ”€â”€ 0001_init.sql
â”‚       â”‚       â””â”€â”€ 0002_indexes.sql
â”‚       â””â”€â”€ modules/
â”‚           â”œâ”€â”€ menu/                # èœå“ç®¡ç†
â”‚           â”‚   â”œâ”€â”€ menu.router.ts
â”‚           â”‚   â”œâ”€â”€ menu.service.ts
â”‚           â”‚   â””â”€â”€ menu.repo.ts
â”‚           â”œâ”€â”€ tables/              # æ¡Œä½ç®¡ç†
â”‚           â”‚   â”œâ”€â”€ tables.router.ts
â”‚           â”‚   â”œâ”€â”€ tables.service.ts
â”‚           â”‚   â””â”€â”€ tables.repo.ts
â”‚           â”œâ”€â”€ sessions/            # ç”¨é¤ä¼šè¯
â”‚           â”‚   â”œâ”€â”€ sessions.router.ts
â”‚           â”‚   â”œâ”€â”€ sessions.service.ts
â”‚           â”‚   â””â”€â”€ sessions.repo.ts
â”‚           â”œâ”€â”€ tickets/             # ç‚¹é¤å·¥å•
â”‚           â”‚   â”œâ”€â”€ tickets.router.ts
â”‚           â”‚   â”œâ”€â”€ tickets.service.ts
â”‚           â”‚   â””â”€â”€ tickets.repo.ts
â”‚           â”œâ”€â”€ serving/             # ä¸Šèœç®¡ç†
â”‚           â”‚   â”œâ”€â”€ serving.router.ts
â”‚           â”‚   â”œâ”€â”€ serving.service.ts
â”‚           â”‚   â””â”€â”€ serving.repo.ts
â”‚           â”œâ”€â”€ checkout/            # ç»“è´¦
â”‚           â”‚   â”œâ”€â”€ checkout.router.ts
â”‚           â”‚   â”œâ”€â”€ checkout.service.ts
â”‚           â”‚   â””â”€â”€ checkout.repo.ts
â”‚           â”œâ”€â”€ stats/               # ç»Ÿè®¡
â”‚           â”‚   â”œâ”€â”€ stats.router.ts
â”‚           â”‚   â”œâ”€â”€ stats.service.ts
â”‚           â”‚   â””â”€â”€ stats.repo.ts
â”‚           â””â”€â”€ sse/                 # å®æ—¶æ¨é€
â”‚               â”œâ”€â”€ sse.router.ts
â”‚               â””â”€â”€ sse.hub.ts
â”œâ”€â”€ web/                             # å‰ç«¯
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.ts
â”‚       â”œâ”€â”€ App.vue
â”‚       â”œâ”€â”€ router/
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â”œâ”€â”€ api/                     # API è¯·æ±‚å±‚
â”‚       â”‚   â”œâ”€â”€ client.ts            # axios/fetch å°è£…
â”‚       â”‚   â”œâ”€â”€ menu.ts
â”‚       â”‚   â”œâ”€â”€ tables.ts
â”‚       â”‚   â”œâ”€â”€ orders.ts
â”‚       â”‚   â”œâ”€â”€ serving.ts
â”‚       â”‚   â”œâ”€â”€ checkout.ts
â”‚       â”‚   â”œâ”€â”€ stats.ts
â”‚       â”‚   â””â”€â”€ sse.ts               # SSE è¿æ¥ç®¡ç†
â”‚       â”œâ”€â”€ stores/                  # Pinia çŠ¶æ€
â”‚       â”‚   â”œâ”€â”€ menu.ts
â”‚       â”‚   â”œâ”€â”€ tables.ts
â”‚       â”‚   â”œâ”€â”€ orders.ts
â”‚       â”‚   â””â”€â”€ cart.ts
â”‚       â”œâ”€â”€ views/                   # é¡µé¢
â”‚       â”‚   â”œâ”€â”€ TableMap.vue         # æ¡Œä½æ€»è§ˆï¼ˆPC é¦–é¡µï¼‰
â”‚       â”‚   â”œâ”€â”€ Ordering.vue         # ç‚¹é¤æ“ä½œï¼ˆPC æ ¸å¿ƒé¡µé¢ï¼‰
â”‚       â”‚   â”œâ”€â”€ Serving.vue          # ä¸Šèœé˜Ÿåˆ—ï¼ˆPCï¼‰
â”‚       â”‚   â”œâ”€â”€ Checkout.vue         # ç»“è´¦ï¼ˆPCï¼‰
â”‚       â”‚   â”œâ”€â”€ Stats.vue            # ç»Ÿè®¡ä»ªè¡¨ç›˜ï¼ˆPCï¼‰
â”‚       â”‚   â”œâ”€â”€ MenuConfig.vue       # èœå“ç®¡ç†ï¼ˆPCï¼‰
â”‚       â”‚   â””â”€â”€ mobile/              # ç§»åŠ¨ç«¯é¡µé¢
â”‚       â”‚       â”œâ”€â”€ MobileHome.vue   # Tab 1ï¼šé¤æ¡Œæ€»è§ˆ
â”‚       â”‚       â”œâ”€â”€ MobileServing.vue# Tab 2ï¼šä¸Šèœé¡ºåº
â”‚       â”‚       â”œâ”€â”€ MobileStats.vue  # Tab 3ï¼šè¥ä¸šç»Ÿè®¡
â”‚       â”‚       â””â”€â”€ MobileOrdering.vue # å…¨å±ç‚¹é¤å­é¡µé¢
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ layout/
â”‚       â”‚   â”‚   â”œâ”€â”€ AppSidebar.vue   # PC ä¾§è¾¹å¯¼èˆª
â”‚       â”‚   â”‚   â”œâ”€â”€ MobileNav.vue    # ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ ï¼ˆ3-Tabï¼‰
â”‚       â”‚   â”œâ”€â”€ business/
â”‚       â”‚   â”‚   â”œâ”€â”€ TableCard.vue    # æ¡Œä½å¡ç‰‡ï¼ˆå«é‡‘é¢+æœªä¸Šèœå“åˆ—è¡¨ï¼ŒåŒèœå“å åŠ è®¡æ•°ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ DishCard.vue     # èœå“å¡ç‰‡ï¼ˆç‚¹å‡»+1ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ QuickAddTile.vue # ä¸´æ—¶èœå“å¿«é€Ÿæ·»åŠ 
â”‚       â”‚   â”‚   â”œâ”€â”€ CartPanel.vue    # è´­ç‰©è½¦é¢æ¿
â”‚       â”‚   â”‚   â”œâ”€â”€ CategoryTabs.vue # åˆ†ç±»æ ‡ç­¾é¡µ
â”‚       â”‚   â”‚   â”œâ”€â”€ ServingItem.vue  # ä¸Šèœé˜Ÿåˆ—é¡¹
â”‚       â”‚   â”‚   â””â”€â”€ ServingQueue.vue # ä¸Šèœé˜Ÿåˆ—ç»„ä»¶ï¼ˆPC/ç§»åŠ¨ç«¯å¤ç”¨ï¼‰
â”‚       â”‚   â””â”€â”€ common/
â”‚       â”‚       â”œâ”€â”€ QuantityStepper.vue
â”‚       â”‚       â””â”€â”€ PriceDisplay.vue
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â”œâ”€â”€ currency.ts          # åˆ†â†’å…ƒ æ ¼å¼åŒ–
â”‚       â”‚   â””â”€â”€ search.ts            # æ‹¼éŸ³é¦–å­—æ¯æ¨¡ç³Šæœç´¢
â”‚       â””â”€â”€ types/
â”‚           â””â”€â”€ index.ts
â””â”€â”€ package.json                     # monorepo æ ¹é…ç½®
```

## æ•°æ®åº“è®¾è®¡

é‡‘é¢ç»Ÿä¸€ä½¿ç”¨æ•´æ•°åˆ†ï¼ˆcentsï¼‰ï¼Œé¿å…æµ®ç‚¹ç²¾åº¦é—®é¢˜ã€‚

### æ ¸å¿ƒè¡¨

| è¡¨å | ç”¨é€” | å…³é”®å­—æ®µ |
|------|------|----------|
| `menu_category` | èœå“åˆ†ç±» | `id`, `name`, `sort_order`, `is_enabled` |
| `menu_dish` | é¢„è®¾èœå“ | `id`, `category_id`, `name`, `sell_price_cents`, `cost_price_cents`, `is_enabled` |
| `dining_table` | å›ºå®šæ¡Œä½ | `id`, `table_no`, `sort_order`, `is_enabled` |
| `table_session` | ç”¨é¤ä¼šè¯ï¼ˆä¸€æ¡Œä¸€æ¬¡ç”¨é¤ï¼‰ | `id`, `table_id`, `status(DINING/PENDING_CHECKOUT/CLOSED)`, `opened_at`, `closed_at` |
| `order_ticket` | ç‚¹é¤å·¥å•ï¼ˆæ¯æ¬¡åŠ èœä¸ºä¸€ä¸ªå·¥å•ï¼‰ | `id`, `session_id`, `created_at`, `note` |
| `order_ticket_item` | å·¥å•æ˜ç»†ï¼ˆå«ä»·æ ¼å¿«ç…§ï¼‰ | `id`, `ticket_id`, `source_dish_id(NULL=ä¸´æ—¶èœ)`, `dish_name_snapshot`, `category_snapshot`, `unit_sell_price_cents`, `unit_cost_price_cents`, `qty_ordered`, `qty_served`, `qty_voided` |
| `payment` | ç»“è´¦è®°å½• | `id`, `session_id(UNIQUE)`, `method(CASH/WECHAT/ALIPAY)`, `amount_cents`, `paid_at`, `business_day` |

### å…³é”®è®¾è®¡å†³ç­–

1. ä»·æ ¼å¿«ç…§ï¼šä¸‹å•æ—¶å°†å”®ä»·å’Œæˆæœ¬ä»·å¿«ç…§åˆ° `order_ticket_item`ï¼Œç»Ÿè®¡åˆ©æ¶¦åŸºäºå¿«ç…§è€Œéå½“å‰èœå•ä»·æ ¼
2. ä¸´æ—¶èœå“ï¼š`source_dish_id = NULL`ï¼Œåç§°å’Œä»·æ ¼ç›´æ¥å­˜å…¥å¿«ç…§å­—æ®µ
3. å•æ´»è·ƒä¼šè¯çº¦æŸï¼šæ¯å¼ æ¡ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªé CLOSED çš„ session
4. æ•°é‡ä¸‰æ€ï¼š`qty_ordered`ï¼ˆä¸‹å•æ•°ï¼‰ã€`qty_served`ï¼ˆå·²ä¸Šèœæ•°ï¼‰ã€`qty_voided`ï¼ˆå·²å–æ¶ˆæ•°ï¼‰ï¼Œå¾…ä¸Šèœæ•° = ordered - served - voided
5. SQLite é…ç½®ï¼š`PRAGMA foreign_keys=ON; journal_mode=WAL; busy_timeout=5000;`

## API è®¾è®¡

ç»Ÿä¸€å“åº”æ ¼å¼ï¼š
```json
{ "ok": true, "data": {}, "meta": { "requestId": "...", "ts": "..." } }
{ "ok": false, "error": { "code": "TABLE_OCCUPIED", "message": "..." } }
```

### èœå“ç®¡ç†
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/categories` | è·å–æ‰€æœ‰åˆ†ç±» |
| POST | `/api/v1/categories` | åˆ›å»ºåˆ†ç±» |
| PATCH | `/api/v1/categories/:id` | æ›´æ–°åˆ†ç±» |
| GET | `/api/v1/dishes?q=&categoryId=&enabled=` | æœç´¢/ç­›é€‰èœå“ |
| POST | `/api/v1/dishes` | åˆ›å»ºèœå“ |
| PATCH | `/api/v1/dishes/:id` | æ›´æ–°èœå“ |

### æ¡Œä½ä¸ä¼šè¯
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/tables` | è·å–æ‰€æœ‰æ¡Œä½ï¼ˆå«å½“å‰ä¼šè¯çŠ¶æ€ï¼‰ |
| GET | `/api/v1/tables/summary` | ç§»åŠ¨ç«¯é¦–é¡µä¸“ç”¨ï¼šæ‰€æœ‰æ¡Œä½ + é‡‘é¢ + æœªä¸Šèœå“åˆ—è¡¨ï¼ˆåŒèœå“å åŠ è®¡æ•°ï¼‰ |
| GET | `/api/v1/tables/:tableId/summary` | å•æ¡Œä½æ‘˜è¦ï¼ˆSSE äº‹ä»¶åå®šå‘åˆ·æ–°ï¼‰ |
| POST | `/api/v1/tables` | åˆ›å»ºæ¡Œä½ |
| PATCH | `/api/v1/tables/:id` | æ›´æ–°æ¡Œä½ |
| POST | `/api/v1/tables/:tableId/sessions` | å¼€å°ï¼ˆåˆ›å»ºä¼šè¯ï¼‰ |
| GET | `/api/v1/sessions/:sessionId` | è·å–ä¼šè¯è¯¦æƒ…ï¼ˆå«æ‰€æœ‰å·¥å•å’Œæ˜ç»†ï¼‰ |

### ç‚¹é¤ä¸ä¿®æ”¹
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/sessions/:sessionId/tickets` | æäº¤ç‚¹é¤å·¥å•ï¼ˆå«ä¸´æ—¶èœå“ï¼‰ |
| PATCH | `/api/v1/ticket-items/:itemId` | ä¿®æ”¹æ•°é‡/å–æ¶ˆï¼ˆä»…æœªä¸Šèœéƒ¨åˆ†ï¼‰ |

### ä¸Šèœ
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/serving-queue` | è·å–å¾…ä¸Šèœé˜Ÿåˆ—ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰ |
| POST | `/api/v1/ticket-items/:itemId/serve` | æ ‡è®°å·²ä¸Šèœ |

### ç»“è´¦
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/sessions/:sessionId/checkout` | ç»“è´¦ï¼ˆå¹‚ç­‰ï¼Œéœ€ Idempotency-Keyï¼‰ |

### ç»Ÿè®¡
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/stats/revenue?from=&to=` | è¥ä¸šé¢ç»Ÿè®¡ |
| GET | `/api/v1/stats/rankings/quantity?from=&to=` | é”€é‡æ’è¡Œ |
| GET | `/api/v1/stats/rankings/revenue?from=&to=` | é”€å”®é¢æ’è¡Œ |
| GET | `/api/v1/stats/rankings/profit?from=&to=` | åˆ©æ¶¦æ’è¡Œ |
| GET | `/api/v1/stats/dashboard?from=&to=` | ç§»åŠ¨ç«¯èšåˆï¼šè¥ä¸šé¢ + ä¸‰ä¸ªæ’è¡Œæ¦œä¸€æ¬¡è¿”å› |

### SSE å®æ—¶æ¨é€
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/events` | SSE äº‹ä»¶æµï¼ˆsession/ticket/serving/checkout å˜æ›´é€šçŸ¥ï¼‰ |

## å‰ç«¯é¡µé¢ä¸äº¤äº’è®¾è®¡

### é¡µé¢è·¯ç”±

PC ç«¯ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰ï¼š
| è·¯ç”± | é¡µé¢ | è¯´æ˜ |
|------|------|------|
| `/` | TableMap | æ¡Œä½æ€»è§ˆï¼ˆé¦–é¡µï¼‰ |
| `/order/:tableId` | Ordering | ç‚¹é¤æ“ä½œï¼ˆæ ¸å¿ƒé¡µé¢ï¼‰ |
| `/serving` | Serving | ä¸Šèœé˜Ÿåˆ— |
| `/checkout/:sessionId` | Checkout | ç»“è´¦é¡µé¢ |
| `/stats` | Stats | ç»Ÿè®¡ä»ªè¡¨ç›˜ |
| `/menu-config` | MenuConfig | èœå“/åˆ†ç±»ç®¡ç† |

ç§»åŠ¨ç«¯ï¼ˆ3-tab åº•éƒ¨å¯¼èˆª + å…¨å±ç‚¹é¤å­é¡µé¢ï¼‰ï¼š
| è·¯ç”± | é¡µé¢ | è¯´æ˜ |
|------|------|------|
| `/m` | MobileHome | Tab 1ï¼šé¤æ¡Œæ€»è§ˆï¼ˆæ¯æ¡Œæ˜¾ç¤ºé‡‘é¢+æœªä¸Šèœå“åˆ—è¡¨ï¼‰ |
| `/m/serving` | MobileServing | Tab 2ï¼šä¸Šèœé¡ºåºï¼ˆå…¨å±€æŒ‰æ—¶é—´æ’åºï¼‰ |
| `/m/stats` | MobileStats | Tab 3ï¼šè¥ä¸šç»Ÿè®¡ï¼ˆè¥ä¸šé¢+æ’è¡Œæ¦œï¼‰ |
| `/m/order/:tableId` | MobileOrdering | å…¨å±ç‚¹é¤é¡µé¢ï¼ˆä» Tab 1 ç‚¹å‡»æ¡Œä½è¿›å…¥ï¼‰ |

ç§»åŠ¨ç«¯é€šè¿‡åº•éƒ¨å¯¼èˆªåˆ‡æ¢ 3 ä¸ª Tabï¼Œç‚¹é¤æ˜¯ç‹¬ç«‹å…¨å±å­é¡µé¢ï¼ˆéæŠ½å±‰ï¼‰ã€‚

### PC ç«¯ç‚¹é¤é¡µé¢å¸ƒå±€ï¼ˆä¸‰æ ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†ç±»å¯¼èˆª  â”‚    èœå“ç½‘æ ¼         â”‚   å½“å‰è®¢å•    â”‚
â”‚ (ä¾§è¾¹æ )  â”‚  [ä¸´æ—¶æ·»åŠ ] [æœç´¢]  â”‚   (è´­ç‰©è½¦)    â”‚
â”‚          â”‚  [èœå“å¡ç‰‡...]      â”‚   æ€»è®¡: Â¥xxx  â”‚
â”‚ çƒ¤ä¸²ç±»    â”‚                    â”‚   [æäº¤è®¢å•]   â”‚
â”‚ çƒ¤é±¼ç±»    â”‚                    â”‚              â”‚
â”‚ å‡‰èœç±»    â”‚                    â”‚              â”‚
â”‚ é¥®å“ç±»    â”‚                    â”‚              â”‚
â”‚ ä¸»é£Ÿç±»    â”‚                    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç§»åŠ¨ç«¯å¸ƒå±€ï¼ˆ3-Tab åº•éƒ¨å¯¼èˆªï¼‰

#### Tab 1ï¼šé¤æ¡Œæ€»è§ˆï¼ˆé¦–é¡µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¥ çƒ§çƒ¤åº—                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ 1å·æ¡Œ  Â¥128 â”‚ â”‚ 2å·æ¡Œ  ç©ºé—² â”‚â”‚ â† æ¡Œä½å¡ç‰‡ç½‘æ ¼
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚            â”‚â”‚   çŠ¶æ€é¢œè‰²åŒºåˆ†
â”‚ â”‚ Â· ç¾Šè‚‰ä¸²Ã—15 â”‚ â”‚            â”‚â”‚
â”‚ â”‚ Â· çƒ¤é±¼Ã—1    â”‚ â”‚            â”‚â”‚ â† æœªä¸Šèœå“åˆ—è¡¨
â”‚ â”‚ Â· çƒ¤ç¿…Ã—3    â”‚ â”‚            â”‚â”‚   åŒèœå“å åŠ è®¡æ•°
â”‚ â”‚ Â· å•¤é…’Ã—2    â”‚ â”‚            â”‚â”‚   æ— æ˜¾ç¤ºä¸Šé™
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ 3å·æ¡Œ  Â¥256 â”‚ â”‚ 4å·æ¡Œ  ç©ºé—² â”‚â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚            â”‚â”‚
â”‚ â”‚ Â· å‡‰èœæ‹¼ç›˜Ã—1â”‚ â”‚            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ½ é¤æ¡Œ]  [ğŸ“‹ ä¸Šèœ]  [ğŸ“Š ç»Ÿè®¡] â”‚ â† åº•éƒ¨å¯¼èˆª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ¡Œä½å¡ç‰‡è®¾è®¡è¦ç‚¹ï¼š
- å›ºå®šé«˜åº¦å¡ç‰‡ï¼Œä¿æŒç½‘æ ¼å¯¹é½
- æœªä¸Šèœå“åˆ—è¡¨æ— æ˜¾ç¤ºä¸Šé™ï¼ŒåŒèœå“å åŠ è®¡æ•°ï¼ˆå¦‚"ç¾Šè‚‰ä¸²Ã—15"ï¼Œä¸ä¼šå‡ºç°åŒèœå“å ä¸¤è¡Œï¼‰
- ç©ºé—²æ¡Œç°è‰²èƒŒæ™¯ï¼Œç”¨é¤ä¸­æš–æ©™è‰²ï¼Œå¾…ç»“è´¦ç»¿è‰²
- ç‚¹å‡»ä»»æ„æ¡Œä½ â†’ è¿›å…¥å…¨å±ç‚¹é¤é¡µé¢

#### Tab 2ï¼šä¸Šèœé¡ºåº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ ä¸Šèœé˜Ÿåˆ— (12é¡¹å¾…ä¸Š)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [1å·æ¡Œ] ç¾Šè‚‰ä¸²Ã—10  5åˆ†é’Ÿå‰ â”‚ â”‚ â† æŒ‰ä¸‹å•æ—¶é—´æ’åº
â”‚ â”‚                   [å·²ä¸Šèœ]â”‚ â”‚   å¤§æŒ‰é’®ï¼Œæ–¹ä¾¿æ“ä½œ
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [3å·æ¡Œ] çƒ¤é±¼Ã—1    8åˆ†é’Ÿå‰ â”‚ â”‚
â”‚ â”‚                   [å·²ä¸Šèœ]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [1å·æ¡Œ] çƒ¤ç¿…Ã—5   12åˆ†é’Ÿå‰ â”‚ â”‚
â”‚ â”‚                   [å·²ä¸Šèœ]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ½ é¤æ¡Œ]  [ğŸ“‹ ä¸Šèœ]  [ğŸ“Š ç»Ÿè®¡] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä¸Šèœé˜Ÿåˆ—è®¾è®¡è¦ç‚¹ï¼š
- å…¨å±åˆ—è¡¨ï¼Œæ¯é¡¹æ˜¾ç¤ºï¼šæ¡Œå·ã€èœåã€æ•°é‡ã€ä¸‹å•æ—¶é—´
- "å·²ä¸Šèœ"æŒ‰é’®æ”¾åœ¨å³ä¾§ï¼Œå¤§å°ºå¯¸ï¼Œæ–¹ä¾¿å•æ‰‹æ“ä½œ
- ç‚¹å‡»"å·²ä¸Šèœ"åè¯¥é¡¹ç«‹å³ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œä¸ä¿ç•™å·²å®ŒæˆåŒºåŸŸ
- é˜Ÿåˆ—ä¸­ä»…æ˜¾ç¤ºæœªä¸Šèœçš„èœå“

#### Tab 3ï¼šè¥ä¸šç»Ÿè®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š è¥ä¸šç»Ÿè®¡                   â”‚
â”‚  [ä»Šæ—¥] [æœ¬å‘¨] [è‡ªå®šä¹‰æ—¥æœŸ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    ä»Šæ—¥è¥ä¸šé¢              â”‚â”‚
â”‚  â”‚    Â¥ 2,580               â”‚â”‚ â† å¤§å­—ä½“çªå‡ºæ˜¾ç¤º
â”‚  â”‚    å…± 18 å•               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚
â”‚  ğŸ† é”€é‡æ’è¡Œ                  â”‚
â”‚  1. ç¾Šè‚‰ä¸²     320ä¸²         â”‚
â”‚  2. çƒ¤ç¿…       85ä»½          â”‚
â”‚  3. å•¤é…’       62ç“¶          â”‚
â”‚                              â”‚
â”‚  ğŸ’° åˆ©æ¶¦æ’è¡Œ                  â”‚
â”‚  1. çƒ¤é±¼       Â¥580         â”‚
â”‚  2. ç¾Šè‚‰ä¸²     Â¥480         â”‚
â”‚  3. çƒ¤ç¿…       Â¥320         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ½ é¤æ¡Œ]  [ğŸ“‹ ä¸Šèœ]  [ğŸ“Š ç»Ÿè®¡] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ç»Ÿè®¡é¡µè®¾è®¡è¦ç‚¹ï¼š
- "æ‘˜è¦ä¼˜å…ˆ"ï¼šå¤§æ•°å­—å±•ç¤ºè¥ä¸šé¢ï¼Œç®€æ´æ’è¡Œåˆ—è¡¨
- ç§»åŠ¨ç«¯ä¸ç”¨å¤æ‚å›¾è¡¨ï¼Œç”¨æ•°å­— + è¿›åº¦æ¡å³å¯
- æ—¥æœŸåˆ‡æ¢ï¼šä»Šæ—¥/æœ¬å‘¨/è‡ªå®šä¹‰

#### ç§»åŠ¨ç«¯å…¨å±ç‚¹é¤é¡µé¢ï¼ˆä» Tab 1 è¿›å…¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† è¿”å›] 1å·æ¡Œ        [æœç´¢] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¨éƒ¨] [çƒ¤ä¸²] [çƒ¤é±¼] [å‡‰èœ]   â”‚ â† åˆ†ç±»æ ‡ç­¾æ¨ªå‘æ»šåŠ¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚[+]   â”‚ â”‚ç¾Šè‚‰ä¸²â”‚ â”‚ç‰›è‚‰ä¸²â”‚  â”‚ â† é¦–ä½ï¼šä¸´æ—¶æ·»åŠ 
â”‚ â”‚ä¸´æ—¶æ·»åŠ â”‚ â”‚ Â¥3  â”‚ â”‚ Â¥5  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚é¸¡ç¿…  â”‚ â”‚çƒ¤é±¼  â”‚ â”‚å•¤é…’  â”‚  â”‚
â”‚ â”‚ Â¥4  â”‚ â”‚ Â¥58 â”‚ â”‚ Â¥8  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€ å·²ç‚¹èœå“ â”€â”€                â”‚ â† å¯æŠ˜å çš„å·²ç‚¹åˆ—è¡¨
â”‚ ç¾Šè‚‰ä¸²Ã—10  Â¥30  [3/10å·²ä¸Š]   â”‚
â”‚ çƒ¤é±¼Ã—1    Â¥58  [0/1å·²ä¸Š]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€»è®¡: Â¥128    [æäº¤] [ç»“è´¦]  â”‚ â† åº•éƒ¨å›ºå®šæ“ä½œæ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç§»åŠ¨ç«¯è®¾è®¡è¦ç‚¹

1. 3-Tab åº•éƒ¨å¯¼èˆªï¼šé¤æ¡Œ | ä¸Šèœ | ç»Ÿè®¡ï¼Œç‚¹é¤æ˜¯ç‹¬ç«‹å…¨å±å­é¡µé¢
2. æ¡Œä½å¡ç‰‡æœªä¸Šèœå“åˆ—è¡¨æ— æ˜¾ç¤ºä¸Šé™ï¼ŒåŒèœå“å åŠ è®¡æ•°ï¼ˆä¸ä¼šåŒèœå“å ä¸¤è¡Œï¼‰
3. ä¸Šèœé˜Ÿåˆ—å…¨å±å±•ç¤ºï¼Œä»…æ˜¾ç¤ºæœªä¸Šèœå“ï¼Œæ ‡è®°å·²ä¸Šèœåç«‹å³ç§»é™¤
4. "å·²ä¸Šèœ"å¤§æŒ‰é’®æ”¾å³ä¾§ï¼Œæ–¹ä¾¿å•æ‰‹æ“ä½œ
5. ç»Ÿè®¡é¡µ"æ‘˜è¦ä¼˜å…ˆ"ï¼šå¤§æ•°å­—è¥ä¸šé¢ + ç®€æ´æ’è¡Œåˆ—è¡¨
6. èœå“ç®¡ç†ç­‰å¤æ‚æ“ä½œä»…åœ¨ PC ç«¯

### é€šç”¨äº¤äº’è¦ç‚¹

1. èœå“å¡ç‰‡ç‚¹å‡»å³ +1ï¼Œæ— éœ€ç¡®è®¤å¼¹çª—
2. ä¸´æ—¶èœå“ï¼šå¸¸é©»"å¿«é€Ÿæ·»åŠ "å…¥å£ï¼Œä»…éœ€è¾“å…¥åç§°å’Œä»·æ ¼
3. æ‹¼éŸ³é¦–å­—æ¯æœç´¢ï¼šè¾“å…¥ "yrc" åŒ¹é… "ç¾Šè‚‰ä¸²"ï¼ˆPC ç«¯ï¼‰
4. æ•°é‡ä¿®æ”¹ï¼š+/- æ­¥è¿›å™¨ï¼Œæ”¯æŒç›´æ¥è¾“å…¥æ•°å­—
5. ä¸Šèœé˜Ÿåˆ—ï¼šæŒ‰è®¢å•æ—¶é—´æ’åºï¼Œç‚¹å‡»"å·²ä¸Šèœ"å³æ ‡è®°
6. è§†è§‰åé¦ˆï¼šæ·»åŠ èœå“æ—¶å¡ç‰‡é—ªçƒç¡®è®¤åŠ¨ç”»

### æ¡Œä½çŠ¶æ€é¢œè‰²
| çŠ¶æ€ | é¢œè‰² | è¯´æ˜ |
|------|------|------|
| ç©ºé—² | ç°ç™½ | å¯ç‚¹å‡»å¼€å° |
| ç”¨é¤ä¸­ | æš–æ©™è‰² | æ˜¾ç¤ºå·²ç‚¹èœå“æ•°å’Œé‡‘é¢ |
| å¾…ç»“è´¦ | ç»¿è‰²è„‰å†² | æç¤ºéœ€è¦ç»“è´¦ |

### Pinia Store è®¾è®¡

```typescript
// useMenuStore - èœå“æ•°æ®
state: { categories: ICategory[], dishes: IDish[] }
actions: { fetchMenu(), addTempDish() }

// useTableStore - æ¡Œä½çŠ¶æ€
state: { tables: ITable[] }
getters: { activeTables, idleTables }

// useCartStore - å½“å‰ç‚¹é¤è´­ç‰©è½¦ï¼ˆæŒä¹…åŒ–ï¼‰
state: { sessionId, tableId, items: ICartItem[] }
actions: { addItem(), removeItem(), updateQty(), submitOrder(), clear() }
getters: { totalCents, itemCount }

// useOrderStore - è®¢å•/ä¸Šèœæ•°æ®
state: { servingQueue: IServingItem[] }
actions: { fetchServingQueue(), markServed() }
```

## å®æ–½æ­¥éª¤

### Step 1: é¡¹ç›®åˆå§‹åŒ–
- åˆ›å»º monorepo ç»“æ„ï¼ˆserver + webï¼‰
- é…ç½® TypeScriptã€ESLintã€Prettier
- åç«¯ï¼šExpress + better-sqlite3 + cors
- å‰ç«¯ï¼šVite + Vue 3 + Naive UI + Tailwind CSS + Pinia
- é¢„æœŸäº§ç‰©ï¼šå¯è¿è¡Œçš„ç©ºé¡¹ç›®éª¨æ¶

### Step 2: æ•°æ®åº“å±‚
- å®ç°è¿ç§»è¿è¡Œå™¨
- ç¼–å†™ 0001_init.sqlï¼ˆå»ºè¡¨ + çº¦æŸï¼‰
- ç¼–å†™ 0002_indexes.sqlï¼ˆæ€§èƒ½ç´¢å¼•ï¼‰
- é…ç½® SQLite PRAGMA
- é¢„æœŸäº§ç‰©ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨å»ºè¡¨çš„æ•°æ®åº“å±‚

### Step 3: åç«¯åŸºç¡€è®¾æ–½
- ç»Ÿä¸€å“åº”å°è£…ï¼ˆok/error envelopeï¼‰
- é¢†åŸŸé”™è¯¯ç±»å’Œ HTTP æ˜ å°„
- è¯·æ±‚æ ¡éªŒä¸­é—´ä»¶
- è¯·æ±‚ ID ä¸­é—´ä»¶
- é¢„æœŸäº§ç‰©ï¼šå¯å¤ç”¨çš„åç«¯åŸºç¡€è®¾æ–½

### Step 4: èœå“ç®¡ç†æ¨¡å—ï¼ˆåç«¯ + å‰ç«¯ï¼‰
- åç«¯ï¼šåˆ†ç±»å’Œèœå“ CRUD API
- å‰ç«¯ï¼šMenuConfig é¡µé¢ï¼ˆåˆ†ç±»ç®¡ç† + èœå“ç®¡ç†ï¼‰
- é¢„æœŸäº§ç‰©ï¼šå¯å½•å…¥å’Œç®¡ç†èœå“çš„å®Œæ•´åŠŸèƒ½

### Step 5: æ¡Œä½ç®¡ç†æ¨¡å—ï¼ˆåç«¯ + å‰ç«¯ï¼‰
- åç«¯ï¼šæ¡Œä½ CRUD + ä¼šè¯å¼€å° API + `tables/summary` èšåˆç«¯ç‚¹
- å‰ç«¯ PCï¼šTableMap é¡µé¢ï¼ˆæ¡Œä½ç½‘æ ¼ + çŠ¶æ€æ˜¾ç¤º + å¼€å°æ“ä½œï¼‰
- å‰ç«¯ç§»åŠ¨ç«¯ï¼šMobileHome é¡µé¢ï¼ˆæ¡Œä½å¡ç‰‡ç½‘æ ¼ + æœªä¸Šèœå“æ™ºèƒ½é¢„è§ˆï¼‰
- TableCard ç»„ä»¶ï¼šæ˜¾ç¤ºæ¡Œå·ã€é‡‘é¢ã€æœªä¸Šèœå“å®Œæ•´åˆ—è¡¨ï¼ˆåŒèœå“å åŠ è®¡æ•°ï¼‰ã€çŠ¶æ€é¢œè‰²
- åº•éƒ¨å¯¼èˆªæ ç»„ä»¶ï¼ˆ3-Tabï¼‰
- é¢„æœŸäº§ç‰©ï¼šPC å’Œç§»åŠ¨ç«¯çš„å¯è§†åŒ–æ¡Œä½ç®¡ç†

### Step 6: ç‚¹é¤æ¨¡å—ï¼ˆåç«¯ + å‰ç«¯ï¼‰â­ æ ¸å¿ƒ
- åç«¯ï¼šå·¥å•åˆ›å»º + æ˜ç»†ä¿®æ”¹ APIï¼ˆå«ä¸´æ—¶èœå“ã€ä»·æ ¼å¿«ç…§ï¼‰
- å‰ç«¯ PCï¼šOrdering é¡µé¢ï¼ˆä¸‰æ å¸ƒå±€ + åˆ†ç±»ç­›é€‰ + æœç´¢ + å¿«é€Ÿæ·»åŠ  + è´­ç‰©è½¦ï¼‰
- å‰ç«¯ç§»åŠ¨ç«¯ï¼šMobileOrdering å…¨å±ç‚¹é¤é¡µé¢ï¼ˆåˆ†ç±»æ ‡ç­¾ + èœå“ç½‘æ ¼ + å·²ç‚¹åˆ—è¡¨ + åº•éƒ¨æ“ä½œæ ï¼‰
- é¢„æœŸäº§ç‰©ï¼šPC å’Œç§»åŠ¨ç«¯å®Œæ•´çš„ç‚¹é¤æ“ä½œæµç¨‹

### Step 7: ä¸Šèœç®¡ç†æ¨¡å—ï¼ˆåç«¯ + å‰ç«¯ï¼‰
- åç«¯ï¼šä¸Šèœé˜Ÿåˆ—æŸ¥è¯¢ + æ ‡è®°å·²ä¸Šèœ API
- å‰ç«¯ PCï¼šServing é¡µé¢ï¼ˆæŒ‰æ—¶é—´æ’åºçš„å¾…ä¸Šèœåˆ—è¡¨ + ä¸€é”®æ ‡è®°ï¼‰
- å‰ç«¯ç§»åŠ¨ç«¯ï¼šMobileServing é¡µé¢ï¼ˆå…¨å±ä¸Šèœé˜Ÿåˆ— + å¤§å°ºå¯¸"å·²ä¸Šèœ"æŒ‰é’®ï¼‰
- æ¡Œä½å¡ç‰‡é€šè¿‡ SSE å®æ—¶æ›´æ–°æœªä¸Šèœå“åˆ—è¡¨
- é¢„æœŸäº§ç‰©ï¼šPC ç‹¬ç«‹é¡µé¢ + ç§»åŠ¨ç«¯ Tab 2

### Step 8: ç»“è´¦æ¨¡å—ï¼ˆåç«¯ + å‰ç«¯ï¼‰
- åç«¯ï¼šç»“è´¦ APIï¼ˆæœåŠ¡ç«¯è®¡ç®—æ€»é¢ + å¹‚ç­‰å¤„ç† + å…³é—­ä¼šè¯ï¼‰
- å‰ç«¯ï¼šCheckout é¡µé¢ï¼ˆæ˜ç»†æ±‡æ€» + æ”¯ä»˜æ–¹å¼é€‰æ‹© + ç¡®è®¤ç»“è´¦ï¼‰
- é¢„æœŸäº§ç‰©ï¼šå®Œæ•´ç»“è´¦æµç¨‹

### Step 9: ç»Ÿè®¡æ¨¡å—ï¼ˆåç«¯ + å‰ç«¯ï¼‰
- åç«¯ï¼šè¥ä¸šé¢ + æ’è¡Œæ¦œ APIï¼ˆæ—¥æœŸèŒƒå›´æŸ¥è¯¢ï¼‰+ `stats/dashboard` èšåˆç«¯ç‚¹
- å‰ç«¯ PCï¼šStats é¡µé¢ï¼ˆECharts å›¾è¡¨ + æ—¥æœŸé€‰æ‹©å™¨ + æ’è¡Œæ¦œåˆ—è¡¨ï¼‰
- å‰ç«¯ç§»åŠ¨ç«¯ï¼šMobileStats é¡µé¢ï¼ˆå¤§æ•°å­—è¥ä¸šé¢ + ç®€æ´æ’è¡Œåˆ—è¡¨ + æ—¥æœŸåˆ‡æ¢ï¼‰
- é¢„æœŸäº§ç‰©ï¼šPC è¯¦ç»†å›¾è¡¨ + ç§»åŠ¨ç«¯ç®€æ´æ‘˜è¦

### Step 10: SSE å®æ—¶åŒæ­¥
- åç«¯ï¼šSSE äº‹ä»¶æµ + é¢†åŸŸäº‹ä»¶å‘å¸ƒ
- å‰ç«¯ï¼šSSE è¿æ¥ç®¡ç† + è‡ªåŠ¨åˆ·æ–°å—å½±å“çš„æ•°æ®
- é¢„æœŸäº§ç‰©ï¼šPC å’Œæ‰‹æœºå®æ—¶åŒæ­¥

### Step 11: æ”¶å°¾ä¼˜åŒ–
- PC ç«¯ï¼šä¾§è¾¹æ å¯¼èˆª
- ç§»åŠ¨ç«¯ï¼šè‡ªåŠ¨æ£€æµ‹è®¾å¤‡è·³è½¬åˆ° `/m` è·¯ç”±
- æ‹¼éŸ³é¦–å­—æ¯æœç´¢ï¼ˆPC ç«¯ï¼‰
- åŠ¨ç”»å’Œè§†è§‰åé¦ˆ
- æ•°æ®å¤‡ä»½è„šæœ¬
- é¢„æœŸäº§ç‰©ï¼šå¯äº¤ä»˜çš„å®Œæ•´ç³»ç»Ÿ

## å…³é”®ä¸šåŠ¡é€»è¾‘ä¼ªä»£ç 

### ç»“è´¦ï¼ˆäº‹åŠ¡ + å¹‚ç­‰ï¼‰
```typescript
function checkoutSession(sessionId, paymentMethod, idempotencyKey) {
  return db.transaction(() => {
    // 1. æ£€æŸ¥ä¼šè¯çŠ¶æ€
    const session = getSession(sessionId)
    if (session.status === 'CLOSED') return existingPayment

    // 2. å¹‚ç­‰æ£€æŸ¥
    const replay = getPaymentByIdempotencyKey(sessionId, idempotencyKey)
    if (replay) return replay

    // 3. æœåŠ¡ç«¯é‡æ–°è®¡ç®—æ€»é¢ï¼ˆä¸ä¿¡ä»»å®¢æˆ·ç«¯ï¼‰
    const total = computeSessionTotal(sessionId) // SUM(sell_price * (qty_ordered - qty_voided))
    if (total <= 0) throw 'EMPTY_BILL'

    // 4. åŸå­å†™å…¥ï¼šæ’å…¥æ”¯ä»˜è®°å½• + å…³é—­ä¼šè¯
    insertPayment({ sessionId, amount: total, method: paymentMethod, businessDay: today() })
    closeSession(sessionId)

    // 5. å‘å¸ƒ SSE äº‹ä»¶
    sse.publish('checkout.completed', { sessionId })
    sse.publish('table.updated', { tableId: session.tableId })
  })
}
```

### ä¸Šèœæ ‡è®°ï¼ˆè¾¹ç•Œæ£€æŸ¥ï¼‰
```typescript
function serveItem(itemId, qtyDelta) {
  return db.transaction(() => {
    const item = getTicketItem(itemId)
    const pending = item.qty_ordered - item.qty_served - item.qty_voided
    if (qtyDelta > pending) throw 'SERVE_EXCEEDS_PENDING'

    incrementServed(itemId, qtyDelta)
    sse.publish('serving.updated', { itemId })
  })
}
```

### åˆ©æ¶¦æ’è¡ŒæŸ¥è¯¢
```sql
SELECT dish_name_snapshot AS name,
       SUM((unit_sell_price_cents - unit_cost_price_cents) * (qty_ordered - qty_voided)) AS profit_cents
FROM order_ticket_item i
JOIN order_ticket t ON t.id = i.ticket_id
JOIN table_session s ON s.id = t.session_id
JOIN payment p ON p.session_id = s.id
WHERE p.business_day BETWEEN ? AND ?
GROUP BY dish_name_snapshot
ORDER BY profit_cents DESC
LIMIT ?
```

## é£é™©ä¸ç¼“è§£

| é£é™© | ç¼“è§£æªæ–½ |
|------|----------|
| æµè§ˆå™¨æ„å¤–å…³é—­ä¸¢å¤±æœªæäº¤è®¢å• | Pinia æŒä¹…åŒ–åˆ° localStorage |
| SQLite æ–‡ä»¶æŸå | WAL æ¨¡å¼ + æ¯æ—¥è‡ªåŠ¨å¤‡ä»½ |
| å±€åŸŸç½‘æ–­å¼€å¯¼è‡´æ‰‹æœºæ— æ³•è®¿é—® | æ ¸å¿ƒæ“ä½œåœ¨ PC ç«¯å®Œæˆï¼Œæ‰‹æœºä¸ºè¾…åŠ© |
| èœå“æ”¹ä»·åå†å²è®¢å•é‡‘é¢ä¸å¯¹ | ä¸‹å•æ—¶å¿«ç…§ä»·æ ¼ï¼Œç»Ÿè®¡åŸºäºå¿«ç…§ |
| åŒæ—¶åœ¨ PC å’Œæ‰‹æœºæ“ä½œå¯¼è‡´å†²çª | SSE å®æ—¶åŒæ­¥ + æœåŠ¡ç«¯äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§ |
| è¯¯æ“ä½œç»“è´¦ | å¹‚ç­‰ key é˜²é‡å¤ + å¯è€ƒè™‘åç»­å¢åŠ æ’¤é”€åŠŸèƒ½ |

## SESSION_IDï¼ˆä¾› /ccg:execute ä½¿ç”¨ï¼‰
- CODEX_SESSION: 019c6b9a-e9de-7d93-9809-3f2b0a386103
- GEMINI_SESSION: 002dfcf8-7cce-428a-928d-f7cc49e0f0d9
